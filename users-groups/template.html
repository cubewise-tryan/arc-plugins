<div class="tm1-usersGroups">
   <div class="tm1-usersGroups-Heading">
      <div class="toolbar">
         <label class="page-title">
            <i class="fa fa-sitemap"></i> {{instance | uppercase}}:<span translate="MANAGEUAG"></span>
         </label>
         <button ng-class="{'btn btn-success' : messageSuccess, 'btn btn-warning' : messageWarning}" ng-if="message">
            <span ng-class="{'fa fa-check' : messageSuccess,'fa fa-warning' : messageWarning}" aria-hidden="true"></span><span>{{message}}</span>
         </button>
      </div>
   </div>

   <div class="tm1-usersGroups-Body">
      <uib-tabset active="selectedTab">
         <uib-tab index="0" heading="{{'TABUSERS' | translate}}" class="tm1-usersTab">
            <div class="row" class="tm1-usersTab-Tools">
               <div class="col-4">
                  <div class="input-group">
                     <input type="text" ng-model="selections.filterUser" placeholder="{{'SEARCHUSER' | translate}}" class="form-control" style="display:inline;" />
                     <span class="input-group-append">
                        <button ng-disabled="!selections.filterUser.length" class="btn btn-secondary" title="{{'CLEARUAG' | translate}}" ng-click="selections.filterUser = ''">
                           <i class="fa fa-fw fa-remove"></i>
                        </button>
                     </span>
                  </div>
               </div>
               <div class="col-4">
                  <div class="input-group">
                     <span class="input-group-prepend">
                        <button ng-disabled="!selections.filterGroup.length" class="btn btn-secondary inactive" ng-if="includedInGroup" title="{{'GROUPINCLUDE' | translate}}" ng-click="toggleIncludedInGroup()">
                           <i class="fa fa-plus" ></i>
                        </button>
                        <button ng-disabled="!selections.filterGroup.length" class="btn btn-secondary inactive" ng-if="!includedInGroup" title="{{'GROUPEXCLUDE' | translate}}" ng-click="toggleIncludedInGroup()">
                           <i class="fa fa-ban" ></i>
                        </button>
                     </span>
                     <input type="text" ng-model="selections.filterGroup" placeholder="{{'SEARCHGROUP' | translate}}" class="form-control" style="display:inline;" />
                     <span class="input-group-append">
                        <button ng-disabled="!selections.filterGroup.length" class="btn btn-secondary" title="{{'CLEARUAG' | translate}}" ng-click="selections.filterGroup = ''">
                           <i class="fa fa-fw fa-remove"></i>
                        </button>
                     </span>
                  </div>
               </div>
               <div class="col-4">
                     <div class="toolbar">
                        <div class="btn-toolbar pull-right" style="margin-bottom: 10px;">
                           <div class="btn-group">
                              <button class="btn btn-primary"  title="{{'ADDUSER' | translate}}" ng-click="addUser()">
                                 <i class="fa fa-plus"></i>
                              </button>
                           </div>
                        </div>
                     </div>
               </div>
            </div>

            <div class="row" class="tm1-usersTab-Table">
               <div class="col-12">
                  <auto-height>
                     <div class="card">
                        <div class="card-body">
                           <table class="table table-hover table-sm">
                              <thead>
                              <tr>
                                 <th style="width:2px;"></th>
                                 <th class="pl-0" style="width: 40px;" translate="NAMEUSER"></th>
                                 <th style="width: 40px;" translate="ALIASUSER"></th>
                                 <th style="width: 40px;" translate="ADDGROUP"></th>
                                 <th translate="GROUPSUSER" ></th>
                              </tr>
                              </thead>
                              <tbody>
                                 <tr ng-repeat="user in usersWithGroups | filter:listFilter track by $index">
                                    <td class="align-middle pr-0">
                                       <a href="" class="text-danger pt-1"  ng-click="deleteUser(user.Name)" title="{{'DELETEUAG' | translate}}" >
                                          <i class="fa fa-close"></i>
                                       </a>
                                       <a href="" class="text-primary pl-1 pt-1" ng-click="editUser($index)" title="{{'EDITUAG' | translate}}" >
                                          <i class="fa fa-edit"></i>
                                       </a>
                                    </td>
                                    <td class="pl-0" style="width: 40px;" >
                                       <div ng-class="{'text-success font-weight-bold':user.IsActive}" class="form-control form-control-sm pl-0" style="cursor:default; border-color: white;">
                                          {{user.Name}}
                                       </div>
                                    </td>
                                    <td>
                                       <input type="text" class="form-control form-control-sm" ng-model="usersWithGroups[$index].displayName" ng-blur="updateUserDisplayName(usersWithGroups[$index].Name, usersWithGroups[$index].displayName)" style="width:100%;">
                                    </td>
                                    <td>
                                       <input type="text" class="form-control form-control-sm"
                                              ng-model="selectedGroup"
                                              uib-typeahead="name as Group.Name for Group in Groups | filter:$viewValue | limitTo:8"
                                              typeahead-on-select="addUserToGroup(user.FriendlyName, $item.Name, user.Groups)"
                                              placeholder="{{'TYPEGROUP' | translate}}"
                                               >
                                    </td>
                                    <td  style="width:500px;">
                                       <div ng-repeat="group in user.Groups | limitTo:user.groupsDisplay | orderBy:'Name'" >
                                          <div style="float:left;">
                                             <div class="badge ml-1" ng-style="generateHSLColour(group.Name)" style="cursor:default;">
                                                {{group.Name}}
                                                <a><i class="fa fa-search" ng-click="selections.filterGroup = group.Name" title="{{'SEARCHGROUP' | translate}}"></i></a>
                                                <a><i class="fa fa-fw fa-remove" ng-click="removeUserFromGroup(user.Name,group.Name)" title="{{'REMOVEUSERFROMGROUP' | translate}}"></i></a>
                                             </div>
                                          </div>
                                       </div>
                                       <div style="float:left;" class="tm1-showMoreGroups" ng-if="user.groupsRemaining">
                                          <a class="badge badge-secondary badge-sm ml-1" style="color:#fff;" title="{{'GROUPSSHOWMORE' | translate}}" ng-click="showMoreGroups($index)">
                                             {{user.groupsRemaining}} more
                                             <i class="fa fa-arrow-right" ></i>
                                          </a>
                                       </div>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                     </div>
                  </auto-height>
               </div>
            </div>
         </uib-tab>

         <uib-tab index="1" heading="{{'TABGROUPS' | translate}}" class="tm1-groupsTab">
            <!-- WORK IN PROGRESS -->
            <div class="row" class="tm1-groupsTab-Tools">
               <div class="col-4">
                  <div class="input-group">
                     <input type="text" ng-model="selections.filterGroup" placeholder="{{'SEARCHGROUP' | translate}}" class="form-control" style="display:inline;" />
                     <span class="input-group-append">
                        <button ng-disabled="!selections.filterUser.length" class="btn btn-secondary" title="{{'CLEARUAG' | translate}}" ng-click="selections.filterUser = ''">
                           <i class="fa fa-fw fa-remove"></i>
                        </button>
                     </span>
                  </div>
               </div>
               <div class="col-4">
                  <div class="input-group">
                     <input type="text" ng-model="selections.filterUser" placeholder="{{'SEARCHUSER' | translate}}" class="form-control" style="display:inline;" />
                     <span class="input-group-append">
                        <button ng-disabled="!selections.filterGroup.length" class="btn btn-secondary" title="{{'CLEARUAG' | translate}}" ng-click="selections.filterGroup = ''">
                           <i class="fa fa-fw fa-remove"></i>
                        </button>
                     </span>
                  </div>

               </div>
               <div class="col-4">
                  <div class="toolbar">
                     <div class="btn-toolbar pull-right" style="margin-bottom: 10px;">
                        <div class="btn-group">
                           <button class="btn btn-primary"  title="{{'ADDUSER' | translate}}" ng-click="addGroup()">
                              <i class="fa fa-plus"></i>
                           </button>
                        </div>
                     </div>
                  </div>
               </div>
            </div>

            <div class="row" class="tm1-groupsTab-Table">
               <div class="col-12">
                  <auto-height>
                     <div class="card">
                        <div class="card-body">
                           <table class="table table-hover table-sm">
                              <thead>
                              <tr>
                                 <th style="width: 40px;" translate="NAMEGROUP"></th>
                                 <th style="width: 40px;" translate="USERGROUPS" ></th>
                                 <th ></th>
                              </tr>
                              </thead>
                              <tbody>
                                 <tr ng-repeat="group in groupsWithUsers | filter:listFilter track by $index">
                                    <td class="align-top" style="width: 40px;" title="{{'EDITGROUPHEADING' | translate}}" >
                                       <button class="btn btn-sm btn-link btn-block text-left" title="{{'EDITUSERHEADING' | translate}}" ng-click="editGroup($index)">
                                          <i class="fa fa-edit" ></i>
                                          {{group.Name}}
                                       </button>
                                    </td>
                                    <td style="width:500px;">
                                       <div ng-repeat="user in group.Users | orderBy:'Name' " >
                                          <div style="float:left;">
                                             <a class="badge ml-1" title="{{'REMOVEUSERFROMGROUP' | translate}}" ng-style="generateHSLColour(user.Name)" ng-click="removeUserFromGroup(user.Name,group.Name)">
                                                <i class="fa fa-fw fa-remove" ></i>
                                                {{user.Name}}
                                             </a>
                                          </div>
                                       </div>
                                       <div style="float:left;" class="tm1-showLessGroups" ng-if="displayLessGroupButton($index)">
                                          <a class="badge badge-primary badge-sm ml-1" style="color:#fff;" title="{{'GROUPSSHOWLESS' | translate}}" ng-click="showLessGroups($index)">
                                             <i class="fa fa-arrow-left" ></i>
                                             Less
                                          </a>
                                       </div>

                                       <div style="float:left;" class="tm1-showMoreGroups" ng-if="displayMoreGroupButton($index)">
                                          <a class="badge badge-primary badge-sm ml-1" style="color:#fff;" title="{{'GROUPSSHOWMORE' | translate}}" ng-click="showMoreGroups($index)">
                                             More (20)
                                             <!-- {{usersWithGroups[userIndex].groupsRemaining}} -->
                                             <i class="fa fa-arrow-right" ></i>
                                          </a>
                                       </div>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                     </div>
                  </auto-height>
               </div>
            </div>
         </uib-tab>
      </uib-tabset>
   </div>
</div>


